Anda adalah AI agent yang sangat ahli dalam pengembangan bot trading full-stack. Saya ingin Anda membuat bot Telegram untuk trading XAUUSD (Emas) dengan modal kecil (100rb-500rb IDR). Bot ini harus beroperasi 24/7 dan mengotomatiskan seluruh proses sinyal trading.

Berikut adalah detail lengkap yang saya butuhkan:

**1. Aset Trading:**
   *   XAUUSD (Emas).

**2. Strategi Trading (Scalping M1-M5) & Konfigurasi:**
   *   **Timeframe Analisis:** M1 dan M5. Prioritas utama untuk sinyal entry adalah M1/M5.
   *   **Indikator yang Dapat Dikonfigurasi (via Environment Variables):**
      *   `EMA_PERIODS`: List of integers (e.g., "5,10,20") untuk Exponential Moving Average.
      *   `RSI_PERIOD`: Integer (e.g., "14") untuk Relative Strength Index.
      *   `RSI_OVERSOLD_LEVEL`: Integer (e.g., "30").
      *   `RSI_OVERBOUGHT_LEVEL`: Integer (e.g., "70").
      *   `STOCH_K_PERIOD`: Integer (e.g., "14") untuk Stochastic Oscillator.
      *   `STOCH_D_PERIOD`: Integer (e.g., "3").
      *   `STOCH_SMOOTH_K`: Integer (e.g., "3").
      *   `STOCH_OVERSOLD_LEVEL`: Integer (e.g., "20").
      *   `STOCH_OVERBOUGHT_LEVEL`: Integer (e.g., "80").
      *   `ATR_PERIOD`: Integer (e.g., "14") untuk Average True Range.
      *   `VOLUME_THRESHOLD_MULTIPLIER`: Float (e.g., "1.5") untuk konfirmasi volume (misal: volume > 1.5x avg_volume).
      *   `MAX_SPREAD_PIPS`: Float (e.g., "5.0") - Ambang batas spread maksimum dalam pips (misal: 0.5 USD untuk XAUUSD).
   *   **Logika Sinyal (Contoh BUY - logik SELL invers):**
      *   **Konfirmasi Tren Naik M5:** EMA cepat > EMA sedang > EMA lambat pada timeframe M5.
      *   **Koreksi/Momentum Naik M1:** RSI di bawah `RSI_OVERSOLD_LEVEL` di M1 dan mulai membalik naik (last_RSI > prev_RSI). Stochastic %K crossing di atas %D dari bawah, di bawah `STOCH_OVERSOLD_LEVEL` di M1.
      *   **Volume:** Volume candle sinyal > `VOLUME_THRESHOLD_MULTIPLIER` * rata-rata volume historis.
      *   **Spread Filter:** `current_spread` < `MAX_SPREAD_PIPS`.
      *   **Entry:** Pada penutupan candle M1/M5 setelah semua kondisi terpenuhi.
      *   **Stop Loss (SL) yang Dapat Dikonfigurasi:**
         *   `SL_ATR_MULTIPLIER`: Float (e.g., "1.0") - SL = `Entry Price` - (`SL_ATR_MULTIPLIER` * `ATR(M5, ATR_PERIOD)`).
         *   `DEFAULT_SL_PIPS`: Float (e.g., "20.0") - SL fallback dalam pips jika ATR tidak cukup data.
      *   **Take Profit (TP) yang Dapat Dikonfigurasi:**
         *   `TP_RR_RATIO`: Float (e.g., "1.5") - TP = `Entry Price` + (`TP_RR_RATIO` * Jarak SL).
         *   `DEFAULT_TP_PIPS`: Float (e.g., "30.0") - TP fallback dalam pips.

**3. Alur Kerja Bot Otomatis & Manajemen Risiko:**
   *   **Pemantauan 24/7:** Bot terus-menerus memantau XAUUSD.
   *   **Deteksi & Pengiriman Sinyal:**
      *   Saat sinyal terpicu, bot kirim pesan ke Telegram.
      *   **Pesan Sinyal:** `Ticker (XAUUSD)`, `Tipe (BUY/SELL)`, `Entry Price`, `Take Profit (TP)`, `Stop Loss (SL)`, `Waktu Sinyal (UTC dan Asia/Jakarta)`, `Spread Saat Sinyal`, `Perkiraan P/L (USD, 0.01 lot)`.
      *   Sertakan **screenshot chart M1/M5** dengan penanda Entry, TP, SL, dan nilai indikator penting.
   *   **Pemantauan Posisi Aktif:** Bot pantau harga (Bid/Ask) hingga TP/SL tercapai.
   *   **Pelaporan Hasil:**
      *   Kirim notifikasi **WIN/LOSE** ke Telegram saat TP/SL tersentuh.
      *   **Pesan Hasil:** `Ticker`, `Tipe`, `Status (WIN/LOSE)`, `Entry Price`, `Exit Price`, `Actual P/L (USD, 0.01 lot)`, `Waktu Penutupan (UTC dan Asia/Jakarta)`.
   *   **Fitur Manajemen Risiko & Overtrading (Dapat Dikonfigurasi):**
      *   `SIGNAL_COOLDOWN_SECONDS`: Integer (e.g., "120") - Cooldown antar sinyal untuk ticker yang sama.
      *   `MAX_TRADES_PER_DAY`: Integer (e.g., "5") - Batas sinyal per hari.
      *   `DAILY_LOSS_PERCENT`: Float (e.g., "3.0") - Bot berhenti jika drawdown harian melebihi % ini.
      *   `RISK_PER_TRADE_PERCENT`: Float (e.g., "0.5") - Persentase risiko per trade (untuk informasi user, bukan eksekusi).

**4. Perintah Bot Telegram:**
   *   `/start`: Pesan selamat datang.
   *   `/help`: Daftar perintah & deskripsi.
   *   `/monitor <ticker>`: Mulai memantau ticker (saat ini hanya XAUUSD).
   *   `/stopmonitor <ticker>`: Hentikan pemantauan.
   *   `/riwayat`: Menampilkan 5-10 riwayat trading terakhir.
   *   `/performa`: Menampilkan statistik performa (Total Trades, Wins, Losses, Win Rate %, Total P/L, Profit Factor, Average RR, Max Drawdown). Sertakan representasi sederhana dari equity curve.
   *   `/settings`: Melihat dan mengubah parameter strategi (bagi user berwenang).

**5. Data Market API (Gratis, Robust, Fallback, MT5-compatible):**
   *   **Prioritas & Fallback:**
      1.  **Polygon.io:** Utama. Prioritaskan WebSocket untuk real-time; fallback ke REST jika WS gagal.
      2.  **Finnhub:** Fallback 1. Prioritaskan WebSocket; fallback ke REST.
      3.  **Twelve Data:** Fallback 2 (Jika delay-nya manageable, sekitar 1-5 menit). Gunakan REST.
      4.  **GoldAPI.io/Metals-API.com/MetalpriceAPI.com:** Fallback terakhir. Hanya untuk harga spot/daily, **tidak cocok untuk scalping M1/M5.** Jika fallback ke sini, bot harus menangguhkan sinyal scalping.
   *   **Kebutuhan Data:** OHLCV untuk M1 dan M5, Bid/Ask (untuk spread). Jika Bid/Ask tidak tersedia, gunakan harga penutupan sebagai mid-price dan terapkan asumsi spread default.
   *   **Koneksi WebSocket:** Logika *reconnect otomatis* dengan *exponential backoff*. Kirim peringatan ke admin Telegram jika WS terputus > `WS_DISCONNECT_ALERT_SECONDS` (e.g., "30").
   *   **REST API Polling:** Interval polling optimal untuk M1 (e.g., 5-15 detik) dengan *retry* dan *exponential backoff*.
   *   **Konfigurasi API Keys (via Environment Variables):** `POLYGON_API_KEY`, `FINNHUB_API_KEY`, `TWELVEDATA_API_KEY`, `GOLDAPI_API_KEY`, `METALS_API_KEY`, `METALPRICE_API_KEY`.
   *   **Rate Limits API:** Implementasi manajemen rate limit untuk setiap API yang digunakan.
   *   **Timestamp:** Semua data API dikonversi dan disimpan dalam UTC.

**6. Teknologi & Deployment:**
   *   **Bahasa:** Python 3.x.
   *   **Library Utama:** `python-telegram-bot`, `requests`, `pandas`, `pandas_ta`, `mplfinance`, `matplotlib`, `numpy`, `SQLAlchemy`, `pytz`.
   *   **Environment:** Replit (development/testing), GitHub (Version Control), Koyeb.com (deployment 24/7).
   *   **Deployment Koyeb:**
      *   **`Dockerfile`:** Siap pakai, termasuk instalasi `libgl1-mesa-glx`, `libgomp1` untuk `matplotlib`.
      *   **Environment Variables:** Gunakan Env Vars untuk semua kunci API, `TELEGRAM_BOT_TOKEN`, `AUTHORIZED_USER_IDS` (comma-separated), dan semua parameter strategi yang dapat dikonfigurasi.
      *   **Persistence (Database):** Gunakan **SQLite** (`/app/data/bot.db`) dengan `SQLAlchemy` ORM dan `WAL mode`. Konfigurasi path untuk volume persisten Koyeb. Sertakan migrasi DB sederhana. Opsi untuk PostgreSQL jika scale.
      *   **Simulate / Demo Mode (`--dry-run`):** Bot mendeteksi & kirim sinyal tapi tidak melacak posisi/mengurangi limit.
      *   **Script Demo Data Replay:** Untuk backtesting/simulasi offline dengan data historis CSV.

**7. Hal Penting Lainnya (Robustness, Keamanan, Observabilitas, Klarifikasi MT5):**
   *   **Pip Value XAUUSD:** Asumsi $10 per 1 lot standar per 1 poin pergerakan. Perhitungan P/L di pesan bot berdasarkan 0.01 lot.
   *   **Klarifikasi MT5 & Eksekusi:** Bot ini adalah **penyedia sinyal, TIDAK berinteraksi langsung atau mengeksekusi trading di platform MT5 Anda.** Pengguna bertanggung jawab penuh untuk eksekusi manual di terminal MT5 mereka, serta untuk manajemen risiko, lot sizing, dan penggunaan leverage.
   *   **Timestamp & Timezone:** Data internal & logging UTC. Sinyal/laporan Telegram tampilkan UTC dan "Asia/Jakarta" (WIB) dengan format ISO 8601.
   *   **Error Handling & Observability:**
      *   **Logging:** Komprehensif (INFO, WARNING, ERROR, CRITICAL) ke file (rotating file handler) dan `stdout`/`stderr`.
      *   **Alerting:** Notifikasi ERROR/CRITICAL ke admin Telegram untuk kegagalan API, WS disconnect, error fatal.
      *   **Metrics Endpoint (`/health`):** Endpoint HTTP sederhana untuk *health checks* Koyeb.
   *   **Chart Generation:** Backend `matplotlib` non-interaktif ('Agg'), `dpi`/`resolution` tinggi, chart M1/M5 dengan indikator, volume, dan penanda Entry/SL/TP yang jelas. Anotasi nilai-nilai penting.
   *   **Unit Tests & Backtester:** Minimal unit tests untuk `strategy.py`/`indicators.py`. Modul dasar backtesting offline dengan data CSV.
   *   **Security & Admin Controls:** Hanya merespons `AUTHORIZED_USER_IDS`. Rate limiting perintah per user. Sanitasi input user.
   *   **Non-Execution Guarantee (README):** **Tegaskan sangat jelas di `README.md` bahwa bot ini TIDAK akan mengeksekusi trade otomatis di akun broker manapun (termasuk MT5).** Bot ini hanya untuk sinyal.